{"version":3,"sources":["webpack:///webpack/universalModuleDefinition?5ca6","webpack:///webpack/bootstrap 7ca66697fbfaef9829de?53c2","webpack:///./src/service/ServiceStub.js?3e7b","webpack:///./src/util/Type.js?cda2","webpack:///./src/service/index.js?d231","webpack:///./src/service/CustomEventService.js?0c83","webpack:///./src/service/LocalStorageService.js?1a2e","webpack:///./src/service/PostMessageService.js?9987","webpack:///./src/service/WKWebViewService.js?0660","webpack:///./src/util/Status.js?d157","webpack:///./src/role/Server.js","webpack:///./src/server.js"],"names":["ServiceStub","options","_type","type","_receiveListener","receiveMessageCallback","isClient","CLIENT","isServer","SERVER","getServiceName","post","dispatch","data","Type","CustomEventService","LocalStorageService","PostMessageService","WKWebViewService","window","CustomEvent","event","params","bubbles","cancelable","detail","undefined","evt","document","createEvent","initCustomEvent","prototype","Event","_sourceElement","source","_targetElement","target","_eventName","addEventListener","bind","ev","dispatchEvent","destroy","removeEventListener","usedStorageKeys","_storageKey","storageKey","localStorage","removeItem","time","Date","getTime","setItem","JSON","stringify","key","newValue","parse","e","_targetWindow","_sourceWindow","_origin","origin","_verifySource","postMessage","_namespace","namespace","_callback","callbackName","hasMsgHandler","webkit","messageHandlers","strData","Status","METHOD_NOT_FOUND","METHOD_SUCCESS","METHOD_ERROR","METHOD_ASYNC","METHOD_READY","METHOD_DESTROY","METHOD_TIMEOUT","Server","methods","service","_connectionEstablished","_onReady","onReady","CONSUMER","_receiveMessage","_serviceClass","_service","_token","_methods","addMethod","methodName","methodFn","removeMethod","jsonrpc","id","method","verify","token","test","_sendError","status","message","that","cb","done","_sendResult","error","methodObj","isAsync","async","result"],"mappings":"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","file":"server.rpcservice.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"RPCService\"] = factory();\n\telse\n\t\troot[\"RPCService\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 15);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 7ca66697fbfaef9829de","import Type from '../util/Type'\n\nexport class ServiceStub {\n\n  constructor(options) {\n    this._type = options.type;\n    this._receiveListener = options.receiveMessageCallback;\n  }\n\n  isClient() {\n    return this._type === Type.CLIENT;\n  }\n\n  isServer() {\n    return this._type === Type.SERVER;\n  }\n\n  /**\n   *\n   */\n  static getServiceName() {\n    throw \"not implemented yet\";\n  }\n\n  /**\n   * to be implemented in the subclass\n   */\n  post() {\n    throw \"post not implemented yet\";\n  }\n\n  /**\n   * forward dispatched data the registered listener\n   * @param data\n   */\n  dispatch(data) {\n    this._receiveListener(data);\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/service/ServiceStub.js","\nconst Type = {\n  SERVER: 'SERVER',\n  CLIENT: 'CLIENT'\n};\n\nexport default Type;\n\n\n// WEBPACK FOOTER //\n// ./src/util/Type.js","\nexport {ServiceStub} from './ServiceStub';\nexport {CustomEventService} from './CustomEventService';\nexport {LocalStorageService} from './LocalStorageService';\nexport {PostMessageService} from './PostMessageService';\nexport {WKWebViewService} from './WKWebViewService';\n\n\n// WEBPACK FOOTER //\n// ./src/service/index.js","import {ServiceStub} from './ServiceStub';\n\n// polyfill for IE 10\n(function () {\n\n  if ( typeof window.CustomEvent === \"function\" ) return false;\n\n  function CustomEvent(event, params) {\n    params = params || { bubbles: false, cancelable: false, detail: undefined };\n    var evt = document.createEvent('CustomEvent');\n    evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n    return evt;\n  }\n\n  CustomEvent.prototype = window.Event.prototype;\n  window.CustomEvent = CustomEvent;\n})();\n\n\nexport class CustomEventService extends ServiceStub {\n\n  constructor(options = {}) {\n    super(options);\n\n    this._sourceElement = options.source || window;\n    this._targetElement = options.target || this._sourceElement;\n    this._eventName     = options.event || 'message';\n\n    this._sourceElement.addEventListener(this._eventName, this.dispatch.bind(this), false);\n  }\n\n  static getServiceName() {\n    return 'CustomEventService'\n  }\n\n  /**\n   * Send a message by using `postMessage` service.\n   * @param {object} data\n   */\n  post(data) {\n    data.source = this._type;\n    const ev = new CustomEvent(this._eventName, {\n      detail: data\n    });\n    this._targetElement.dispatchEvent(ev);\n  }\n\n  /**\n   * Handles received messages\n   * @param {object} detail\n   * @returns {*}\n   */\n  dispatch({detail}) {\n    // ensure provider or customer doesn't dispatch its own message\n    if (detail && detail.source !== this._type) {\n      delete detail.source;\n      super.dispatch(detail);\n    }\n  }\n\n  /**\n   * remove bindings\n   */\n  destroy() {\n    this._sourceElement.removeEventListener(this._eventName, this.dispatch);\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/service/CustomEventService.js","import {ServiceStub} from './ServiceStub';\n\nlet usedStorageKeys = {};\n\nexport class LocalStorageService extends ServiceStub {\n\n  constructor(options) {\n    super(options);\n\n    this._storageKey = options.storageKey || 'rpc:message';\n\n    if (usedStorageKeys[this._storageKey]) {\n      throw `LocalStorageService: key '${this._storageKey}' is already in use by another LocalStorageService`;\n    }\n    usedStorageKeys[this._storageKey] = true;\n\n    // remove old data if exists\n    localStorage.removeItem(this._storageKey);\n\n    window.addEventListener('storage', this.dispatch.bind(this), false);\n  }\n\n  static getServiceName() {\n    return 'LocalStorageService'\n  }\n\n  /**\n   * Send a message by using `localStorage`\n   * @param {object} data\n   */\n  post(data) {\n    data.time = new Date().getTime();\n    data.source = this._type;\n    localStorage.setItem(this._storageKey, JSON.stringify(data));\n  }\n\n  /**\n   * Handles received messages\n   * @param key\n   * @param newValue\n   */\n  dispatch({key, newValue}) {\n\n    if (newValue && key === this._storageKey) {\n      try {\n        const data = JSON.parse(newValue);\n        delete data.time;\n\n        // ensure provider or customer doesn't dispatch its own message\n        if (data.source !== this._type) {\n          delete data.source;\n          super.dispatch(data);\n        }\n      } catch(e) {}\n    }\n  }\n\n  /**\n   * remove bindings\n   */\n  destroy() {\n    window.removeEventListener('storage', this.dispatch);\n    localStorage.removeItem(this._storageKey);\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/service/LocalStorageService.js","import {ServiceStub} from './ServiceStub';\n\nexport class PostMessageService extends ServiceStub {\n\n  constructor(options = {}) {\n    super(options);\n\n    this._targetWindow = options.target || null;\n    this._sourceWindow = options.source || window;\n    this._origin       = options.origin || \"*\";\n    this._verifySource = this._origin !== '*';\n\n    this._sourceWindow.addEventListener('message', this.dispatch.bind(this), false);\n  }\n\n  static getServiceName() {\n    return 'PostMessageService'\n  }\n\n  /**\n   * Send a message by using `postMessage` service.\n   * @param {object} data\n   */\n  post(data) {\n\n    if (this._targetWindow === null) {\n      throw \"windows element for posting messages does not exist\";\n    }\n\n    this._targetWindow.postMessage(data, this._origin);\n  }\n\n  /**\n   * Handles received messages\n   * @param {string} origin\n   * @param {object} data\n   * @param {window} source\n   * @returns {*}\n   */\n  dispatch({origin, data, source}) {\n\n    if (this._verifySource && this._origin !== origin) {\n      return null;\n    }\n\n    super.dispatch(data);\n  }\n\n  /**\n   * remove bindings\n   */\n  destroy() {\n    this._sourceWindow.removeEventListener('message', this.dispatch);\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/service/PostMessageService.js","import {ServiceStub} from './ServiceStub';\n\nexport class WKWebViewService extends ServiceStub {\n\n  constructor(options = {}) {\n    super(options);\n\n    this._namespace = options.namespace;\n    this._callback = options.callbackName || 'rpcReceiveCallback';\n    let hasMsgHandler = false;\n\n    // check if special WKWebView message handler exists\n    try {\n      hasMsgHandler = (typeof window.webkit.messageHandlers[this._namespace].postMessage === 'function');\n    } catch(e) {}\n\n    if (!hasMsgHandler) {\n      throw `WKWebViewService: cannot connect to WKWebView handler 'window.webkit.messageHandlers.${this._namespace}'`;\n    }\n\n    // register callback function (works as response listener)\n    window[this._callback] = this.dispatch.bind(this);\n  }\n\n  static getServiceName() {\n    return 'WKWebViewService'\n  }\n\n  /**\n   * Send a message by using `postMessage` service.\n   * @param {object} data\n   */\n  post(data) {\n    window.webkit.messageHandlers[this._namespace].postMessage(JSON.stringify(data));\n  }\n\n  /**\n   * Handles received messages\n   * @param {string} strData\n   * @returns {*}\n   */\n  dispatch(strData) {\n    try {\n      super.dispatch(JSON.parse(strData));\n    } catch(e) {}\n  }\n\n  /**\n   * remove bindings\n   */\n  destroy() {\n    delete window[this._namespace];\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/service/WKWebViewService.js","\nconst Status = {\n  METHOD_NOT_FOUND: 'METHOD_NOT_FOUND',\n  METHOD_SUCCESS: 'METHOD_SUCCESS',\n  METHOD_ERROR: 'METHOD_ERROR',\n  METHOD_ASYNC: 'METHOD_ASYNC',\n  METHOD_READY: 'METHOD_READY',\n  METHOD_DESTROY: 'METHOD_DESTROY',\n  METHOD_TIMEOUT: 'METHOD_TIMEOUT'\n};\n\nexport default Status;\n\n\n// WEBPACK FOOTER //\n// ./src/util/Status.js","import Status from '../util/Status';\nimport Type from '../util/Type';\n\n\nexport class Server {\n\n  /**\n   *\n   * @param options -\n   * @param methods - function map\n   */\n  constructor(options, methods = {}) {\n\n    if (!options.service) {\n      throw \"missing option 'service' for service class\"\n    }\n\n    this._connectionEstablished = false;\n    this._onReady = typeof options.onReady === 'function' ? options.onReady : null;\n\n    options.type = Type.CONSUMER;\n    options.receiveMessageCallback = this._receiveMessage.bind(this);\n\n    this._serviceClass = options.service;\n    this._service = new this._serviceClass(options);\n    this._token = null;\n    this._methods = methods;\n  }\n\n  /**\n   * register given callback function with `methodName`\n   * @param methodName\n   * @param methodFn\n   * @returns {Consumer}\n   */\n  addMethod(methodName, methodFn) {\n    this._methods[methodName] = methodFn;\n    return this;\n  }\n\n  /**\n   * Remove callback function with given `methodName`\n   * @param methodName\n   */\n  removeMethod(methodName) {\n    if (this._methods[methodName]) {\n      delete this._methods[methodName];\n    }\n    return this;\n  }\n\n  /**\n   * Handles a message sent by a provider and invoke the method.\n   * @param jsonrpc\n   * @param id\n   * @param method\n   * @param params\n   * @param verify\n   * @param token\n   * @param test\n   * @returns {*}\n   * @private\n   */\n  _receiveMessage({jsonrpc, id, method, params, verify, token, test}) {\n\n    if (!this._connectionEstablished && verify && id) {\n      this._connectionEstablished = true;\n      this._token = id;\n      this._service.post({\n        verify,\n        id\n      });\n      if (this._onReady) {\n        this._onReady();\n      }\n    }\n\n    // check JSON RPC format for answer\n    if (!this._connectionEstablished || jsonrpc !== \"2.0\" || !id || !method || token !== this._token) {\n      return;\n    }\n\n    // message with given id does not exist\n    if (!this._methods[method]) {\n      return this._sendError(id, {\n        status: Status.METHOD_NOT_FOUND,\n        message: `method with name ${method} could not be found`\n      });\n    }\n\n    const that = this;\n    const cb = {\n      done(data) {\n        that._sendResult(id, {\n          status: Status.METHOD_SUCCESS,\n          data,\n        });\n      },\n      error(data) {\n        that._sendResult(id, {\n          status: Status.METHOD_ERROR,\n          data,\n        });\n      }\n    };\n    const methodObj = {\n      method: this._methods[method],\n      isAsync: false,\n      async: function() {\n        this.isAsync = true;\n        that._sendResult(id, {\n          status: Status.METHOD_ASYNC\n        });\n        return cb;\n      }\n    };\n\n    // invoke method\n    let result = methodObj.method(params, cb.done, cb.error);\n\n    // stop here if method works asynchronously\n    if (methodObj.isAsync) {\n      return;\n    }\n\n    // undefined result should work as success by documentation\n    if (result === undefined) {\n      result = true;\n    }\n\n    if (result === false || result === null) {\n      return cb.error();\n    }\n    return cb.done(result);\n  }\n\n  /**\n   * send `success` response to the provider\n   * @param id\n   * @param data\n   */\n  _sendResult(id, data) {\n    this._service.post({\n      jsonrpc: \"2.0\",\n      id,\n      result: data,\n    });\n  }\n\n  /**\n   * send `error` response to the provider\n   * @param id\n   * @param data\n   */\n  _sendError(id, data) {\n    this._service.post({\n      jsonrpc: \"2.0\",\n      id,\n      error: data,\n    });\n  }\n\n  destroy() {\n    this._service.destroy();\n    this._methods = {};\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/role/Server.js","\nexport * from './role/Server'\nexport * from './service/index'\n\n\n// WEBPACK FOOTER //\n// ./src/server.js"],"sourceRoot":""}