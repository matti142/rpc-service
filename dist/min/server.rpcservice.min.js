!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.RPCService=t():e.RPCService=t()}(this,function(){return function(e){function t(n){if(o[n])return o[n].exports;var r=o[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var o={};return t.m=e,t.c=o,t.i=function(e){return e},t.d=function(e,o,n){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=15)}([function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.ServiceStub=void 0;var i=o(1),s=n(i);t.ServiceStub=function(){function e(t){r(this,e),this._type=t.type,this._receiveListener=t.receiveMessageCallback}return e.prototype.isClient=function(){return this._type===s.default.CLIENT},e.prototype.isServer=function(){return this._type===s.default.SERVER},e.getServiceName=function(){throw"not implemented yet"},e.prototype.post=function(){throw"post not implemented yet"},e.prototype.dispatch=function(e){this._receiveListener(e)},e}()},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={SERVER:"SERVER",CLIENT:"CLIENT"};t.default=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(0);Object.defineProperty(t,"ServiceStub",{enumerable:!0,get:function(){return n.ServiceStub}});var r=o(3);Object.defineProperty(t,"CustomEventService",{enumerable:!0,get:function(){return r.CustomEventService}});var i=o(4);Object.defineProperty(t,"LocalStorageService",{enumerable:!0,get:function(){return i.LocalStorageService}});var s=o(5);Object.defineProperty(t,"PostMessageService",{enumerable:!0,get:function(){return s.PostMessageService}});var c=o(6);Object.defineProperty(t,"WKWebViewService",{enumerable:!0,get:function(){return c.WKWebViewService}})},function(e,t,o){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.CustomEventService=void 0;var s=o(0);!function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var o=document.createEvent("CustomEvent");return o.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),o}return"function"!=typeof window.CustomEvent&&(e.prototype=window.Event.prototype,void(window.CustomEvent=e))}();t.CustomEventService=function(e){function t(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,t);var i=r(this,e.call(this,o));return i._sourceElement=o.source||window,i._targetElement=o.target||i._sourceElement,i._eventName=o.event||"message",i._sourceElement.addEventListener(i._eventName,i.dispatch.bind(i),!1),i}return i(t,e),t.getServiceName=function(){return"CustomEventService"},t.prototype.post=function(e){e.source=this._type;var t=new CustomEvent(this._eventName,{detail:e});this._targetElement.dispatchEvent(t)},t.prototype.dispatch=function(t){var o=t.detail;o&&o.source!==this._type&&(delete o.source,e.prototype.dispatch.call(this,o))},t.prototype.destroy=function(){this._sourceElement.removeEventListener(this._eventName,this.dispatch)},t}(s.ServiceStub)},function(e,t,o){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorageService=void 0;var s=o(0),c={};t.LocalStorageService=function(e){function t(o){n(this,t);var i=r(this,e.call(this,o));if(i._storageKey=o.storageKey||"rpc:message",c[i._storageKey])throw"LocalStorageService: key '"+i._storageKey+"' is already in use by another LocalStorageService";return c[i._storageKey]=!0,localStorage.removeItem(i._storageKey),window.addEventListener("storage",i.dispatch.bind(i),!1),i}return i(t,e),t.getServiceName=function(){return"LocalStorageService"},t.prototype.post=function(e){e.time=(new Date).getTime(),e.source=this._type,localStorage.setItem(this._storageKey,JSON.stringify(e))},t.prototype.dispatch=function(t){var o=t.key,n=t.newValue;if(n&&o===this._storageKey)try{var r=JSON.parse(n);delete r.time,r.source!==this._type&&(delete r.source,e.prototype.dispatch.call(this,r))}catch(e){}},t.prototype.destroy=function(){window.removeEventListener("storage",this.dispatch),localStorage.removeItem(this._storageKey)},t}(s.ServiceStub)},function(e,t,o){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.PostMessageService=void 0;var s=o(0);t.PostMessageService=function(e){function t(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,t);var i=r(this,e.call(this,o));return i._targetWindow=o.target||null,i._sourceWindow=o.source||window,i._origin=o.origin||"*",i._verifySource="*"!==i._origin,i._sourceWindow.addEventListener("message",i.dispatch.bind(i),!1),i}return i(t,e),t.getServiceName=function(){return"PostMessageService"},t.prototype.post=function(e){if(null===this._targetWindow)throw"windows element for posting messages does not exist";this._targetWindow.postMessage(e,this._origin)},t.prototype.dispatch=function(t){var o=t.origin,n=t.data;t.source;return this._verifySource&&this._origin!==o?null:void e.prototype.dispatch.call(this,n)},t.prototype.destroy=function(){this._sourceWindow.removeEventListener("message",this.dispatch)},t}(s.ServiceStub)},function(e,t,o){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.WKWebViewService=void 0;var s=o(0);t.WKWebViewService=function(e){function t(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,t);var i=r(this,e.call(this,o));i._namespace=o.namespace,i._callback=o.callbackName||"rpcReceiveCallback";var s=!1;try{s="function"==typeof window.webkit.messageHandlers[i._namespace].postMessage}catch(e){}if(!s)throw"WKWebViewService: cannot connect to WKWebView handler 'window.webkit.messageHandlers."+i._namespace+"'";return window[i._callback]=i.dispatch.bind(i),i}return i(t,e),t.getServiceName=function(){return"WKWebViewService"},t.prototype.post=function(e){window.webkit.messageHandlers[this._namespace].postMessage(JSON.stringify(e))},t.prototype.dispatch=function(t){try{e.prototype.dispatch.call(this,JSON.parse(t))}catch(e){}},t.prototype.destroy=function(){delete window[this._namespace]},t}(s.ServiceStub)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={METHOD_NOT_FOUND:"METHOD_NOT_FOUND",METHOD_SUCCESS:"METHOD_SUCCESS",METHOD_ERROR:"METHOD_ERROR",METHOD_ASYNC:"METHOD_ASYNC",METHOD_READY:"METHOD_READY",METHOD_DESTROY:"METHOD_DESTROY",METHOD_TIMEOUT:"METHOD_TIMEOUT"};t.default=n},,,function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Server=void 0;var i=o(7),s=n(i),c=o(1),a=n(c);t.Server=function(){function e(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r(this,e),!t.service)throw"missing option 'service' for service class";this._connectionEstablished=!1,this._onReady="function"==typeof t.onReady?t.onReady:null,t.type=a.default.CONSUMER,t.receiveMessageCallback=this._receiveMessage.bind(this),this._serviceClass=t.service,this._service=new this._serviceClass(t),this._token=null,this._methods=o}return e.prototype.addMethod=function(e,t){return this._methods[e]=t,this},e.prototype.removeMethod=function(e){return this._methods[e]&&delete this._methods[e],this},e.prototype._receiveMessage=function(e){var t=e.jsonrpc,o=e.id,n=e.method,r=e.params,i=e.verify,c=e.token;e.test;if(!this._connectionEstablished&&i&&o&&(this._connectionEstablished=!0,this._token=o,this._service.post({verify:i,id:o}),this._onReady&&this._onReady()),this._connectionEstablished&&"2.0"===t&&o&&n&&c===this._token){if(!this._methods[n])return this._sendError(o,{status:s.default.METHOD_NOT_FOUND,message:"method with name "+n+" could not be found"});var a=this,u={done:function(e){a._sendResult(o,{status:s.default.METHOD_SUCCESS,data:e})},error:function(e){a._sendResult(o,{status:s.default.METHOD_ERROR,data:e})}},f={method:this._methods[n],isAsync:!1,async:function(){return this.isAsync=!0,a._sendResult(o,{status:s.default.METHOD_ASYNC}),u}},l=f.method(r,u.done,u.error);if(!f.isAsync)return void 0===l&&(l=!0),l===!1||null===l?u.error():u.done(l)}},e.prototype._sendResult=function(e,t){this._service.post({jsonrpc:"2.0",id:e,result:t})},e.prototype._sendError=function(e,t){this._service.post({jsonrpc:"2.0",id:e,error:t})},e.prototype.destroy=function(){this._service.destroy(),this._methods={}},e}()},,,,,function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(10);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var r=o(2);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})})}])});
//# sourceMappingURL=server.rpcservice.min.js.map